<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle LOCAL - ETEC</title>
    <link href="css/bootstrap.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f4f7f6; font-family: sans-serif; }
        .card-controle { 
            background: white; padding: 30px; border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 500px; margin: auto;
        }
        .btn-ajuste { width: 60px; height: 50px; font-size: 24px; font-weight: bold; }
        .input-senha { text-align: center; font-size: 30px; font-weight: bold; width: 140px !important; height: 50px; }
        .btn-chamar { width: 100%; margin-top: 10px; font-weight: bold; padding: 15px; font-size: 20px; }
        .contador-group { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="card-controle">
    <h3 class="text-center" style="color:#b11116; font-weight:bold;">CONTROLE LOCAL</h3>
    <p class="text-center text-muted">Funciona apenas no mesmo PC do Painel</p>

    <div style="padding: 20px; background: #f9f9f9; border-radius: 10px; margin-bottom: 20px;">
        <label class="center-block text-center" style="color:#0056b3;">NORMAL</label>
        <div class="contador-group">
            <button class="btn btn-default btn-ajuste" onclick="ajustar('normal', -1)">-</button>
            <input type="number" id="inputNormal" class="form-control input-senha" value="1">
            <button class="btn btn-default btn-ajuste" onclick="ajustar('normal', 1)">+</button>
        </div>
        <button class="btn btn-primary btn-chamar" onclick="chamar('normal')">CHAMAR NORMAL</button>
    </div>

    <div style="padding: 20px; background: #f9f9f9; border-radius: 10px;">
        <label class="center-block text-center" style="color:#d32f2f;">PREFERENCIAL</label>
        <div class="contador-group">
            <button class="btn btn-default btn-ajuste" onclick="ajustar('pref', -1)">-</button>
            <input type="number" id="inputPref" class="form-control input-senha" value="1">
            <button class="btn btn-default btn-ajuste" onclick="ajustar('pref', 1)">+</button>
        </div>
        <button class="btn btn-danger btn-chamar" onclick="chamar('pref')">CHAMAR PREF.</button>
    </div>
</div>

<script>
    // Ao abrir, recupera o último número salvo
    window.onload = function() {
        let salvoNormal = localStorage.getItem('etec_normal') || 1;
        let salvoPref = localStorage.getItem('etec_pref') || 1;
        document.getElementById('inputNormal').value = salvoNormal;
        document.getElementById('inputPref').value = salvoPref;
    }

    function ajustar(tipo, delta) {
        let input = document.getElementById(tipo === 'normal' ? 'inputNormal' : 'inputPref');
        let novoValor = parseInt(input.value) + delta;
        if (novoValor < 1) novoValor = 1;
        input.value = novoValor;
    }

    function chamar(tipo) {
        let input = document.getElementById(tipo === 'normal' ? 'inputNormal' : 'inputPref');
        let valor = parseInt(input.value);
        
        // 1. Salva no Armazenamento Local (Isso dispara o evento no Painel)
        if (tipo === 'normal') {
            localStorage.setItem('etec_senha_atual_normal', valor);
            localStorage.setItem('etec_trigger', 'normal-' + Date.now()); // Força atualização
            localStorage.setItem('etec_normal', valor + 1); // Salva o próximo
        } else {
            localStorage.setItem('etec_senha_atual_pref', valor);
            localStorage.setItem('etec_trigger', 'pref-' + Date.now()); // Força atualização
            localStorage.setItem('etec_pref', valor + 1); // Salva o próximo
        }

        // 2. Incrementa o input visualmente para o próximo
        input.value = valor + 1;
    }
</script>
</body>
</html>
