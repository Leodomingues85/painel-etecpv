<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Chamada - ETEC</title>
    <link href="css/bootstrap.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card-controle { 
            background: white; padding: 25px; border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 450px; margin: auto;
        }
        .titulo { color: #b11116; font-weight: bold; text-align: center; margin-bottom: 5px; }
        .subtitulo { text-align: center; color: #777; font-size: 0.85em; margin-bottom: 20px; }
        .contador-group { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .btn-ajuste { width: 60px; height: 54px; font-size: 24px; font-weight: bold; border-radius: 8px; }
        .input-senha { text-align: center; font-size: 24px; font-weight: bold; height: 54px !important; border: 2px solid #ddd; }
        .btn-chamar { width: 100%; font-size: 1.2em; padding: 15px; font-weight: bold; border-radius: 8px; margin-bottom: 25px; transition: 0.2s; }
        .btn-chamar:active { transform: scale(0.97); }
        .label-setor { font-weight: bold; display: block; text-align: center; margin-top: 10px; color: #333; text-transform: uppercase; letter-spacing: 1px; }
        #status { text-align: center; font-weight: bold; height: 25px; margin-top: 10px; border-radius: 4px; }
        hr { border-top: 2px solid #eee; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card-controle">
            <h2 class="titulo">CONTROLE ETEC</h2>
            <p class="subtitulo">Painel de Chamada via Nuvem</p>
            <hr>

            <label class="label-setor">Senha Normal</label>
            <div class="contador-group">
                <button class="btn btn-default btn-ajuste" onclick="alterarValor('inputNormal', -1)">-</button>
                <input type="number" id="inputNormal" class="form-control input-senha" value="1">
                <button class="btn btn-default btn-ajuste" onclick="alterarValor('inputNormal', 1)">+</button>
            </div>
            <button onclick="enviarParaNuvem('normal')" id="btnNormal" class="btn btn-primary btn-chamar">CHAMAR NORMAL</button>

            <label class="label-setor">Senha Preferencial</label>
            <div class="contador-group">
                <button class="btn btn-default btn-ajuste" onclick="alterarValor('inputPref', -1)">-</button>
                <input type="number" id="inputPref" class="form-control input-senha" value="1">
                <button class="btn btn-default btn-ajuste" onclick="alterarValor('inputPref', 1)">+</button>
            </div>
            <button onclick="enviarParaNuvem('preferencial')" id="btnPref" class="btn btn-danger btn-chamar">CHAMAR PREFERENCIAL</button>

            <div id="status"></div>
        </div>
    </div>

    <script>
        // === LINK DO SEU GOOGLE APPS SCRIPT ===
        const URL_GOOGLE_SCRIPT = "https://script.google.com/macros/s/AKfycbw4JdWjho1FHbHOvfNxRowLJ16FdXQYJSFqVci3WgBFaXrB8KGobzTPEvfMzH83s_1M/exec";

        // Função para aumentar ou diminuir o valor nos botões + e -
        function alterarValor(idCampo, delta) {
            const campo = document.getElementById(idCampo);
            let valorAtual = parseInt(campo.value) || 0;
            if (valorAtual + delta >= 0) {
                campo.value = valorAtual + delta;
            }
        }

        function enviarParaNuvem(tipo) {
            const statusDiv = document.getElementById('status');
            const campoNormal = document.getElementById('inputNormal');
            const campoPref = document.getElementById('inputPref');
            
            let valorBase = (tipo === 'normal') ? campoNormal.value : campoPref.value;
            
            // Formatação: Normal vira 0001, Preferencial vira P001
            let valorFormatado = valorBase.toString().padStart(tipo === 'normal' ? 4 : 3, '0');
            if (tipo === 'preferencial') valorFormatado = 'P' + valorFormatado;

            // Feedback visual de envio
            statusDiv.style.backgroundColor = "#e1f5fe";
            statusDiv.style.color = "#0277bd";
            statusDiv.innerText = "Enviando " + valorFormatado + "...";

            // TÉCNICA DA IMAGEM: Envia os dados sem sofrer bloqueio de CORS
            var img = new Image();
            img.src = `${URL_GOOGLE_SCRIPT}?senha=${valorFormatado}&tipo=${tipo}&t=` + new Date().getTime();
            
            // Após 1 segundo, confirma o envio e incrementa o contador para a próxima senha
            setTimeout(() => {
                statusDiv.style.backgroundColor = "#e8f5e9";
                statusDiv.style.color = "#2e7d32";
                statusDiv.innerText = "Sucesso: " + valorFormatado + " chamada!";
                
                // Incrementa automaticamente o contador
                if(tipo === 'normal') alterarValor('inputNormal', 1);
                else alterarValor('inputPref', 1);

                // Limpa a mensagem de sucesso após 3 segundos
                setTimeout(() => { statusDiv.innerText = ""; statusDiv.style.backgroundColor = "transparent"; }, 3000);
            }, 1000);
        }
    </script>
</body>
</html>



