<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Remoto ETEC</title>
    <link href="css/bootstrap.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        body { padding: 20px; background-color: #f4f7f6; font-family: sans-serif; }
        .card-controle { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
        .titulo { text-align: center; color: #b11116; font-weight: bold; margin-bottom: 20px; }
        .contador-group { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .btn-ajuste { width: 50px; height: 50px; font-size: 20px; font-weight: bold; }
        .input-senha { text-align: center; font-size: 24px; font-weight: bold; width: 100px !important; }
        .btn-chamar { width: 100%; padding: 15px; font-size: 18px; font-weight: bold; border-radius: 8px; }
        #status { text-align: center; margin-top: 15px; font-size: 0.9em; color: #666; }
    </style>
</head>
<body>

<div class="card-controle">
    <h3 class="titulo">CONTROLE MOBILE</h3>
    
    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
        <label class="center-block text-center" style="color:#0d47a1;">NORMAL</label>
        <div class="contador-group">
            <button class="btn btn-default btn-ajuste" onclick="ajustarLocal('normal', -1)">-</button>
            <input type="number" id="inputNormal" class="form-control input-senha" value="0">
            <button class="btn btn-default btn-ajuste" onclick="ajustarLocal('normal', 1)">+</button>
        </div>
        <button class="btn btn-primary btn-chamar" onclick="enviar('normal')">CHAMAR NORMAL</button>
    </div>

    <div style="background: #ffebee; padding: 15px; border-radius: 10px;">
        <label class="center-block text-center" style="color:#b71c1c;">PREFERENCIAL</label>
        <div class="contador-group">
            <button class="btn btn-default btn-ajuste" onclick="ajustarLocal('preferencial', -1)">-</button>
            <input type="number" id="inputPref" class="form-control input-senha" value="0">
            <button class="btn btn-default btn-ajuste" onclick="ajustarLocal('preferencial', 1)">+</button>
        </div>
        <button class="btn btn-danger btn-chamar" onclick="enviar('preferencial')">CHAMAR PREF.</button>
    </div>

    <div id="status">Conectando ao sistema...</div>
</div>

<script>
    // --- COLE A MESMA CONFIGURAÇÃO DO FIREBASE AQUI ---
    const firebaseConfig = {
      apiKey: "AIzaSyD...",
      authDomain: "seu-projeto.firebaseapp.com",
      databaseURL: "https://seu-projeto-default-rtdb.firebaseio.com",
      projectId: "seu-projeto",
      storageBucket: "seu-projeto.appspot.com",
      messagingSenderId: "123...",
      appId: "1:123..."
    };
    // --------------------------------------------------

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    // Ao abrir, pega o valor atual do banco para não começar do zero errado
    db.ref('chamada').once('value').then((snapshot) => {
        const data = snapshot.val();
        if(data) {
            document.getElementById('inputNormal').value = (data.normal || 0) + 1; // Já sugere o próximo
            document.getElementById('inputPref').value = (data.preferencial || 0) + 1;
            document.getElementById('status').innerText = "Conectado e Sincronizado.";
        } else {
            document.getElementById('status').innerText = "Conectado (Iniciando do 1).";
            document.getElementById('inputNormal').value = 1;
            document.getElementById('inputPref').value = 1;
        }
    });

    function ajustarLocal(tipo, delta) {
        let id = (tipo === 'normal') ? 'inputNormal' : 'inputPref';
        let el = document.getElementById(id);
        let val = parseInt(el.value) || 0;
        if (val + delta < 0) return;
        el.value = val + delta;
    }

    function enviar(tipo) {
        let id = (tipo === 'normal') ? 'inputNormal' : 'inputPref';
        let valorParaChamar = parseInt(document.getElementById(id).value);

        document.getElementById('status').innerText = "Enviando...";

        // Atualiza apenas o campo específico no Firebase
        let updates = {};
        updates['chamada/' + tipo] = valorParaChamar;

        db.ref().update(updates, (error) => {
            if (error) {
                document.getElementById('status').innerText = "Erro ao enviar!";
            } else {
                document.getElementById('status').innerText = "Chamado: " + valorParaChamar;
                // Prepara automaticamente o próximo número
                ajustarLocal(tipo, 1);
            }
        });
    }
</script>
</body>
</html>
